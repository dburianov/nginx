
tag=$(date +%Y%m%d%H%M) &&
sudo docker build . \
-t dburianov/nginx-aio:$tag \
-t me-jeddah-1.ocir.io/axtu9g48igga/nginx:$tag \
-t dburianov/nginx-aio:latest \
-t me-jeddah-1.ocir.io/axtu9g48igga/nginx:latest &&
echo $tag \
&& sudo docker run --rm --name nginx-aio dburianov/nginx-aio:$tag

#sudo docker push me-jeddah-1.ocir.io/axtu9g48igga/nginx:latest
#sudo docker push me-jeddah-1.ocir.io/axtu9g48igga/nginx:$tag
#sudo docker push dburianov/nginx-aio:$tag

#-t dburianov/nginx-aio:latest \
#-t me-jeddah-1.ocir.io/axtu9g48igga/nginx:latest \

# sudo docker rmi $(sudo docker images -q)
# --force
#--progress plain

#https://github.com/coreruleset/modsecurity-crs-docker/blob/master/nginx/Dockerfile


sudo docker buildx create --use

#tag=$(date +%Y%m%d%H%M) &&
#sudo docker buildx build --push \
#--platform linux/amd64,linux/arm64,linux/arm/v7 \
#--tag dburianov/nginx-aio:buildx-$tag .

##--platform linux/amd64,linux/arm64,linux/arm/v7,linux/arm/v6 \

#tag=$(date +%Y%m%d%H%M) &&
#sudo docker buildx build --push \
#--platform linux/amd64 \
#--tag dburianov/nginx-aio:buildx-latest \
#--tag dburianov/nginx-aio:buildx-$tag .

tag=$(date +%Y%m%d%H%M) &&
sudo docker buildx build --push \
--platform linux/amd64,linux/arm64 \
--tag dburianov/nginx-aio:buildx-latest \
--tag dburianov/nginx-aio:buildx-$tag .

#sudo docker buildx build --push \
#--platform linux/amd64,linux/arm64,linux/arm/v7 \
#--tag dburianov/nginx-aio:buildx-latest \
#--tag dburianov/nginx-aio:buildx-$tag .

# lua modules
# https://raw.githubusercontent.com/cloudflare/lua-resty-cookie/master/lib/resty/cookie.lua
# https://raw.githubusercontent.com/lunarmodules/luasocket/master/src/url.lua
# https://raw.githubusercontent.com/openresty/lua-resty-redis/master/lib/resty/redis.lua

# https://security.stackexchange.com/questions/44251/openssl-generate-different-types-of-self-signed-certificate
# https://security.stackexchange.com/questions/251713/how-to-use-dh-certificate-to-configure-nginx-server
openssl ecparam -out ecparam.pem -name prime256v1
openssl genpkey -paramfile ecparam.pem -out ecdhkey.pem
# We currently have ssl_ecdh_curve secp384r1; but I thought about extending it to ssl_ecdh_curve X25519:secp384r1;
# openssl ciphers -v
# curl -I -v --tlsv1.2 --tls-max 1.2 https://
# curl -I -v --tlsv1.3 --tls-max 1.3 https://
# https://cromwell-intl.com/open-source/nginx-tls-1.3/security-performance-nginx.html
